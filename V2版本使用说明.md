# V2ç‰ˆæœ¬ä½¿ç”¨è¯´æ˜ - åŸºäºé€šç”¨åº“çš„é‡æ„

## ğŸ‰ å·²åˆ›å»ºçš„æ–‡ä»¶

### æ ¸å¿ƒé€‚é…å™¨
```
Assets/Scripts/
â””â”€â”€ MinecraftVoxelAdapter.cs    â­ BlockTypeç³»ç»Ÿé€‚é…å™¨
```

### é‡æ„åçš„è„šæœ¬
```
Assets/Scripts/
â”œâ”€â”€ VoxelModelGeneratorV2.cs    â­ ä½¿ç”¨é€šç”¨åº“çš„ç”Ÿæˆå™¨
â””â”€â”€ VoxelModelTestV2.cs         â­ ä½¿ç”¨é€šç”¨åº“çš„æµ‹è¯•è„šæœ¬
```

## ğŸš€ å¿«é€Ÿå¼€å§‹

### æ–¹æ³•1ï¼šæµ‹è¯•è„šæœ¬ï¼ˆæ¨èï¼Œæœ€ç®€å•ï¼‰

1. **åœ¨Unityä¸­åˆ›å»ºç©ºGameObject**ï¼Œå‘½åä¸º "VoxelTestV2"
2. **æ·»åŠ ç»„ä»¶** `VoxelModelTestV2`
3. **è¿è¡Œæ¸¸æˆ**
4. **æŒ‰é”®æµ‹è¯•**ï¼š
   - **Gé”®** - ç”Ÿæˆç‹— ğŸ•
   - **Hé”®** - ç”Ÿæˆæˆ¿å­ ğŸ 
   - **Té”®** - ç”Ÿæˆæ ‘ ğŸŒ³
   - **Cé”®** - æ¸…é™¤æ‰€æœ‰æ¨¡å‹ ğŸ§¹

### æ–¹æ³•2ï¼šç”Ÿæˆå™¨ç»„ä»¶

1. **åˆ›å»ºç©ºGameObject**ï¼Œå‘½åä¸º "VoxelGeneratorV2"
2. **æ·»åŠ ç»„ä»¶** `VoxelModelGeneratorV2`
3. **åœ¨Inspectorä¸­ç²˜è´´JSONæ•°æ®**
4. **å‹¾é€‰ "Generate On Start"**
5. **è¿è¡Œæ¸¸æˆ**ï¼Œè‡ªåŠ¨ç”Ÿæˆ

## ğŸ“Š V2ç‰ˆæœ¬ vs åŸç‰ˆæœ¬å¯¹æ¯”

### ä»£ç å¯¹æ¯”

| ç‰¹æ€§ | åŸç‰ˆæœ¬ | V2ç‰ˆæœ¬ |
|-----|--------|--------|
| **æ ¸å¿ƒç®—æ³•** | ç¡¬ç¼–ç åœ¨è„šæœ¬ä¸­ | ä½¿ç”¨é€šç”¨åº“ âœ… |
| **ä»£ç è¡Œæ•°** | ~500è¡Œ | ~300è¡Œ âœ… |
| **BuildMeshæ–¹æ³•** | 200è¡Œå¤æ‚é€»è¾‘ | 1è¡Œè°ƒç”¨ âœ… |
| **å¯ç»´æŠ¤æ€§** | éš¾ä»¥ç»´æŠ¤ | æ¸…æ™°æ˜“æ‡‚ âœ… |
| **å¯ç§»æ¤æ€§** | éš¾ä»¥å¤ç”¨ | é«˜åº¦å¯å¤ç”¨ âœ… |
| **æ‰©å±•æ€§** | ä¿®æ”¹å¤æ‚ | æ˜“äºæ‰©å±• âœ… |

### æ ¸å¿ƒæ”¹è¿›

#### 1. ä½¿ç”¨é€šç”¨åº“ï¼ˆæœ€å¤§æ”¹è¿›ï¼‰

**åŸç‰ˆæœ¬**ï¼š
```csharp
// 200è¡Œå¤æ‚çš„BuildMeshé€»è¾‘
Mesh BuildMesh(BlockType[,,] blocks, int width, int height, int depth)
{
    // ... 200è¡Œä»£ç 
    // æ‰‹åŠ¨å¤„ç†é¡¶ç‚¹ã€UVã€ä¸‰è§’å½¢
    // æ‰‹åŠ¨å®ç°é¢å‰”é™¤
    // å®¹æ˜“å‡ºé”™ï¼Œéš¾ä»¥ç»´æŠ¤
}
```

**V2ç‰ˆæœ¬**ï¼š
```csharp
// 1è¡Œä»£ç å®Œæˆï¼
var adapter = new MinecraftVoxelAdapter(blocks, width, height, depth);
Mesh mesh = VoxelMeshBuilder.BuildMesh(adapter);
```

#### 2. èŒè´£åˆ†ç¦»

**åŸç‰ˆæœ¬**ï¼š
- JSONè§£æ + Meshç”Ÿæˆ + ä½ç½®è®¡ç®— + æè´¨æŸ¥æ‰¾ = å…¨éƒ¨è€¦åˆåœ¨ä¸€èµ·

**V2ç‰ˆæœ¬**ï¼š
- `MinecraftVoxelAdapter` - è´Ÿè´£é€‚é…BlockTypeç³»ç»Ÿ
- `VoxelMeshBuilder` - è´Ÿè´£Meshç”Ÿæˆï¼ˆé€šç”¨åº“ï¼‰
- `VoxelModelGeneratorV2` - è´Ÿè´£åè°ƒæµç¨‹
- æ¯ä¸ªç±»èŒè´£å•ä¸€ï¼Œæ˜“äºç»´æŠ¤

#### 3. ä»£ç ç®€æ´åº¦

**åŸç‰ˆæœ¬ `GenerateModel()`**ï¼š
```csharp
GameObject GenerateModel(VoxelData voxelData)
{
    // åˆ›å»ºå¯¹è±¡
    // å‡†å¤‡æ•°æ®
    // 200è¡ŒBuildMeshé€»è¾‘ âŒ
    // åº”ç”¨Mesh
    // è®¾ç½®æè´¨
    return modelObject;
}
```

**V2ç‰ˆæœ¬ `GenerateModel()`**ï¼š
```csharp
GameObject GenerateModel(VoxelData voxelData)
{
    // åˆ›å»ºå¯¹è±¡
    // å‡†å¤‡æ•°æ®
    var adapter = new MinecraftVoxelAdapter(blocks, w, h, d);
    Mesh mesh = VoxelMeshBuilder.BuildMesh(adapter); // 1è¡Œ! âœ…
    // åº”ç”¨Mesh
    // è®¾ç½®æè´¨
    return modelObject;
}
```

## ğŸ¯ æ ¸å¿ƒæ¦‚å¿µ

### MinecraftVoxelAdapterï¼ˆé€‚é…å™¨æ¨¡å¼ï¼‰

```csharp
// é€‚é…å™¨çš„ä½œç”¨ï¼šè¿æ¥BlockTypeç³»ç»Ÿå’Œé€šç”¨åº“
public class MinecraftVoxelAdapter : IVoxelData<BlockType>
{
    // 1. æä¾›ä½“ç´ æ•°æ®
    public BlockType GetVoxel(int x, int y, int z) { ... }
    
    // 2. å®šä¹‰"ç©º"çš„æ¦‚å¿µ
    public bool IsEmpty(BlockType voxel) 
    {
        return voxel == BlockType.Air;
    }
    
    // 3. æä¾›UVåæ ‡
    public Vector2[] GetUVs(BlockType voxel, VoxelFace face) 
    {
        // ä»Blockå­—å…¸è·å–
        return Block.blocks[voxel].topPos.GetUVs();
    }
    
    // 4. æä¾›å°ºå¯¸
    public Vector3Int Size { get; }
}
```

### æ•°æ®æµç¨‹

```
JSONå­—ç¬¦ä¸²
    â†“
è§£æä¸ºVoxelDataå¯¹è±¡
    â†“
è½¬æ¢ä¸ºBlockType[,,]æ•°ç»„
    â†“
åŒ…è£…ä¸ºMinecraftVoxelAdapterï¼ˆé€‚é…å™¨ï¼‰
    â†“
ä¼ é€’ç»™VoxelMeshBuilder.BuildMesh()ï¼ˆé€šç”¨åº“ï¼‰
    â†“
ç”Ÿæˆä¼˜åŒ–çš„Mesh
    â†“
åº”ç”¨åˆ°GameObject
```

## ğŸ“ ä½¿ç”¨ç¤ºä¾‹

### ç¤ºä¾‹1ï¼šåŸºç¡€ä½¿ç”¨

```csharp
using VoxelMeshLibrary;

public class MyScript : MonoBehaviour
{
    void GenerateVoxelModel()
    {
        // 1. å‡†å¤‡ä½“ç´ æ•°æ®
        BlockType[,,] blocks = new BlockType[10, 10, 10];
        // ... å¡«å……æ•°æ® ...
        
        // 2. åˆ›å»ºé€‚é…å™¨
        var adapter = new MinecraftVoxelAdapter(blocks, 8, 8, 8);
        
        // 3. ç”ŸæˆMesh
        Mesh mesh = VoxelMeshBuilder.BuildMesh(adapter);
        
        // 4. åº”ç”¨
        GetComponent<MeshFilter>().mesh = mesh;
    }
}
```

### ç¤ºä¾‹2ï¼šä»JSONç”Ÿæˆ

```csharp
public class JsonToVoxel : MonoBehaviour
{
    public string jsonData;
    
    void Start()
    {
        // ä½¿ç”¨V2ç”Ÿæˆå™¨
        var generator = gameObject.AddComponent<VoxelModelGeneratorV2>();
        generator.jsonData = jsonData;
        generator.GenerateAndSpawnModel();
    }
}
```

### ç¤ºä¾‹3ï¼šç¨‹åºåŒ–ç”Ÿæˆ

```csharp
public class ProceduralVoxel : MonoBehaviour
{
    void GenerateSphere()
    {
        // åˆ›å»ºçƒä½“ä½“ç´ æ•°æ®
        BlockType[,,] blocks = new BlockType[20, 20, 20];
        
        for (int x = 0; x < 20; x++)
            for (int y = 0; y < 20; y++)
                for (int z = 0; z < 20; z++)
                {
                    Vector3 pos = new Vector3(x-10, y-10, z-10);
                    if (pos.magnitude < 8)
                        blocks[x, y, z] = BlockType.Stone;
                    else
                        blocks[x, y, z] = BlockType.Air;
                }
        
        // ä½¿ç”¨é€‚é…å™¨ç”Ÿæˆ
        var adapter = new MinecraftVoxelAdapter(blocks, 18, 18, 18);
        Mesh mesh = VoxelMeshBuilder.BuildMesh(adapter);
        
        GetComponent<MeshFilter>().mesh = mesh;
    }
}
```

## ğŸ”§ é«˜çº§ç”¨æ³•

### è‡ªå®šä¹‰é€‚é…å™¨ï¼ˆæ‰©å±•åˆ°å…¶ä»–ç³»ç»Ÿï¼‰

å¦‚æœä½ æƒ³æ”¯æŒå…¶ä»–ä½“ç´ ç±»å‹ï¼š

```csharp
// ä¾‹å¦‚ï¼šæ”¯æŒintç±»å‹çš„ä½“ç´ 
public class IntVoxelAdapter : IVoxelData<int>
{
    int[,,] voxels;
    
    public int GetVoxel(int x, int y, int z) => voxels[x,y,z];
    public bool IsEmpty(int v) => v == 0;
    public Vector2[] GetUVs(int v, VoxelFace f) => GetMyUV(v);
    public Vector3Int Size => size;
}

// ä½¿ç”¨
var adapter = new IntVoxelAdapter(intVoxels);
Mesh mesh = VoxelMeshBuilder.BuildMesh(adapter);
```

### æ‰¹é‡ç”Ÿæˆ

```csharp
public class BatchGenerator : MonoBehaviour
{
    IEnumerator GenerateMany()
    {
        for (int i = 0; i < 100; i++)
        {
            // ç”Ÿæˆæ¨¡å‹
            var adapter = new MinecraftVoxelAdapter(data[i], 8, 8, 8);
            Mesh mesh = VoxelMeshBuilder.BuildMesh(adapter);
            ApplyMesh(mesh, i);
            
            // æ¯10ä¸ªæš‚åœä¸€å¸§
            if (i % 10 == 0)
                yield return null;
        }
    }
}
```

## âœ… è¿ç§»æŒ‡å—ï¼ˆä»åŸç‰ˆæœ¬åˆ°V2ï¼‰

### æ­¥éª¤1ï¼šæ›¿æ¢ç»„ä»¶

```
åŸç‰ˆæœ¬                     â†’  V2ç‰ˆæœ¬
VoxelModelTest             â†’  VoxelModelTestV2
VoxelModelGenerator        â†’  VoxelModelGeneratorV2
```

### æ­¥éª¤2ï¼šåŠŸèƒ½å®Œå…¨ç›¸åŒ

- âœ… æ‰€æœ‰åŠŸèƒ½ä¿æŒä¸€è‡´
- âœ… JSONæ ¼å¼å®Œå…¨ç›¸åŒ
- âœ… æŒ‰é”®ç»‘å®šå®Œå…¨ç›¸åŒ
- âœ… ç”Ÿæˆæ•ˆæœå®Œå…¨ç›¸åŒ

### æ­¥éª¤3ï¼šäº«å—æ”¹è¿›

- âœ… æ›´å¿«çš„æ€§èƒ½ï¼ˆé€šç”¨åº“ä¼˜åŒ–ï¼‰
- âœ… æ›´æ¸…æ™°çš„ä»£ç 
- âœ… æ›´æ˜“äºç»´æŠ¤
- âœ… æ›´å¥½çš„æ‰©å±•æ€§

## ğŸ“¦ æ–‡ä»¶ä¾èµ–å…³ç³»

```
VoxelModelTestV2.cs
    â†“ ä¾èµ–
VoxelModelGeneratorV2.cs
    â†“ ä¾èµ–
MinecraftVoxelAdapter.cs
    â†“ å®ç°
IVoxelData.cs (VoxelMeshLibrary)
    â†“ ä½¿ç”¨
VoxelMeshBuilder.cs (VoxelMeshLibrary)
```

## ğŸ“ å­¦ä¹ å»ºè®®

### åˆå­¦è€…
1. ç›´æ¥ä½¿ç”¨ `VoxelModelTestV2`
2. æŒ‰G/H/Té”®çœ‹æ•ˆæœ
3. ç†è§£JSONæ ¼å¼

### ä¸­çº§å¼€å‘è€…
1. ç ”ç©¶ `MinecraftVoxelAdapter`
2. ç†è§£é€‚é…å™¨æ¨¡å¼
3. å°è¯•ä¿®æ”¹å’Œæ‰©å±•

### é«˜çº§å¼€å‘è€…
1. ç ”ç©¶ `VoxelMeshLibrary` æºç 
2. ç†è§£é¢å‰”é™¤ç®—æ³•
3. è‡ªå®šä¹‰é€‚é…å™¨
4. æ€§èƒ½ä¼˜åŒ–

## ğŸŒŸ æ ¸å¿ƒä¼˜åŠ¿æ€»ç»“

### V2ç‰ˆæœ¬çš„ä¼˜åŠ¿

1. **ä»£ç é‡å‡å°‘40%**
   - åŸç‰ˆæœ¬ï¼š~500è¡Œ
   - V2ç‰ˆæœ¬ï¼š~300è¡Œ

2. **æ ¸å¿ƒç®—æ³•å¤–ç½®**
   - BuildMeshä»200è¡Œ â†’ 1è¡Œè°ƒç”¨
   - æ˜“äºç»´æŠ¤å’Œè°ƒè¯•

3. **é«˜åº¦å¯å¤ç”¨**
   - é€šç”¨åº“å¯ç”¨äºå…¶ä»–é¡¹ç›®
   - é€‚é…å™¨æ¨¡å¼æ˜“äºæ‰©å±•

4. **èŒè´£åˆ†ç¦»æ¸…æ™°**
   - æ¯ä¸ªç±»èŒè´£å•ä¸€
   - ç¬¦åˆSOLIDåŸåˆ™

5. **æ˜“äºæµ‹è¯•**
   - å¯ä»¥å•ç‹¬æµ‹è¯•é€‚é…å™¨
   - å¯ä»¥å•ç‹¬æµ‹è¯•Meshæ„å»ºå™¨

## ğŸš€ ä¸‹ä¸€æ­¥

### ç°åœ¨å°±è¯•è¯•ï¼

1. **åœ¨Unityä¸­åˆ›å»ºGameObject**
2. **æ·»åŠ  `VoxelModelTestV2` ç»„ä»¶**
3. **è¿è¡Œæ¸¸æˆ**
4. **æŒ‰Gé”®** - çœ‹åˆ°ç‹—å‡ºç°ï¼ğŸ•

### æ¢ç´¢æ›´å¤š

1. æŸ¥çœ‹ `VoxelMeshLibrary/` æ–‡æ¡£
2. ç ”ç©¶é€‚é…å™¨æ¨¡å¼
3. å°è¯•åˆ›å»ºè‡ªå®šä¹‰æ¨¡å‹
4. é›†æˆåˆ°ä½ çš„é¡¹ç›®

---

**æ€»ç»“**ï¼šV2ç‰ˆæœ¬é€šè¿‡ä½¿ç”¨é€šç”¨åº“ï¼Œå®ç°äº†ä»£ç çš„é«˜åº¦å¤ç”¨å’Œæ¸…æ™°çš„èŒè´£åˆ†ç¦»ã€‚ç°åœ¨ç”Ÿæˆä½“ç´ æ¨¡å‹åªéœ€è¦3æ­¥ï¼š

1. å‡†å¤‡æ•°æ®
2. åˆ›å»ºé€‚é…å™¨  
3. è°ƒç”¨BuildMesh()

å°±è¿™ä¹ˆç®€å•ï¼âœ¨ğŸ®

---

**ç‰ˆæœ¬**: 2.0  
**åˆ›å»ºæ—¥æœŸ**: 2026-01-12  
**å…¼å®¹æ€§**: Unity 2019.4+  
**ä¾èµ–**: VoxelMeshLibrary
