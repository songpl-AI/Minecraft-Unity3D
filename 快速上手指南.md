# 体素模型生成器 - 快速上手指南

## 🎯 功能简介

这个工具可以从JSON数据在Unity场景中生成3D体素模型，非常适合：
- ✨ 与LLM（如GPT、Claude）集成，用自然语言生成3D模型
- 🎮 快速原型设计和测试
- 🏗️ 程序化生成游戏内容
- 📦 使用现有的方块系统和纹理

## 🚀 5分钟快速开始

### 第1步：添加测试脚本

1. 在Unity中打开你的场景（`Assets/Scenes/Game.unity`）
2. 在Hierarchy中创建一个空GameObject，命名为 "VoxelTest"
3. 将 `Assets/Scripts/VoxelModelTest.cs` 拖拽到该GameObject上

完成！✅

### 第2步：运行并测试

1. 点击Unity的 **Play** 按钮
2. 使用以下按键生成不同的模型：
   - **G键** - 生成一只狗 🐕
   - **H键** - 生成一个房子 🏠
   - **T键** - 生成一棵树 🌳
   - **C键** - 清除所有生成的模型 🧹

模型会自动出现在你的角色前方，并自动贴合地面！

### 第3步：观察效果

- 生成的模型使用与地形相同的纹理系统
- 模型会自动进行mesh合并，优化性能
- 可以正常碰撞检测

## 📝 JSON格式说明

### 基本结构

```json
{
  "name": "模型名称",
  "size": {"x": 宽度, "y": 高度, "z": 深度},
  "voxels": [
    {"x": 0, "y": 0, "z": 0, "blockType": "Dirt"},
    {"x": 1, "y": 0, "z": 0, "blockType": "Stone"}
  ]
}
```

### 支持的方块类型

| 类型 | 说明 | 适用场景 |
|-----|------|---------|
| `Grass` | 草方块 | 地面、草坪 |
| `Dirt` | 泥土 | 身体、墙壁 |
| `Stone` | 石头 | 基础、脚 |
| `Trunk` | 树干 | 树、柱子 |
| `Leaves` | 树叶 | 树冠、装饰 |

### 最小示例

一个2x2x2的简单立方体：

```json
{
  "name": "TinyCube",
  "size": {"x": 2, "y": 2, "z": 2},
  "voxels": [
    {"x": 0, "y": 0, "z": 0, "blockType": "Stone"},
    {"x": 1, "y": 0, "z": 0, "blockType": "Stone"},
    {"x": 0, "y": 0, "z": 1, "blockType": "Stone"},
    {"x": 1, "y": 0, "z": 1, "blockType": "Stone"},
    {"x": 0, "y": 1, "z": 0, "blockType": "Dirt"},
    {"x": 1, "y": 1, "z": 0, "blockType": "Dirt"},
    {"x": 0, "y": 1, "z": 1, "blockType": "Dirt"},
    {"x": 1, "y": 1, "z": 1, "blockType": "Dirt"}
  ]
}
```

## 🎨 如何与LLM集成

### 步骤1：设计提示词

向LLM发送类似这样的提示：

```
请生成一个体素模型的JSON数据，要求如下：
1. 生成一只猫
2. 使用以下方块类型：Grass, Dirt, Stone, Trunk, Leaves
3. 大小控制在10x10x10以内
4. JSON格式如下：
{
  "name": "模型名称",
  "size": {"x": 宽度, "y": 高度, "z": 深度},
  "voxels": [{"x": 0, "y": 0, "z": 0, "blockType": "Dirt"}, ...]
}
```

### 步骤2：获取JSON数据

LLM会返回JSON数据，例如：

```json
{
  "name": "SimpleCat",
  "size": {"x": 6, "y": 5, "z": 8},
  "voxels": [
    ...
  ]
}
```

### 步骤3：在Unity中生成

方法A - 使用VoxelModelGenerator组件：
1. 创建GameObject，添加 `VoxelModelGenerator` 组件
2. 将JSON粘贴到 "Json Data" 字段
3. 勾选 "Generate On Start"
4. 运行游戏

方法B - 通过代码：
```csharp
VoxelModelGenerator generator = GetComponent<VoxelModelGenerator>();
generator.jsonData = llmGeneratedJson;
generator.GenerateAndSpawnModel();
```

## 🔧 高级配置

### 调整生成位置

在Inspector中调整 `VoxelModelTest` 组件的参数：

- **Spawn Distance**: 距离玩家的距离（默认8米）
- **Snap To Ground**: 是否自动贴地（默认开启）

### 自定义生成位置

修改 `VoxelModelGenerator.cs` 中的 `CalculateSpawnPosition` 方法：

```csharp
Vector3 position = new Vector3(10, 0, 10); // 固定位置
```

### 添加更多测试模型

在 `VoxelModelTest.cs` 中添加新的方法：

```csharp
string GetMyCustomJson()
{
    return @"{
      ""name"": ""MyModel"",
      ""size"": {""x"": 5, ""y"": 5, ""z"": 5},
      ""voxels"": [...]
    }";
}
```

然后在 `Update()` 中添加按键绑定：

```csharp
if (Input.GetKeyDown(KeyCode.M))
{
    GenerateModel(GetMyCustomJson(), "MyModel");
}
```

## 📊 性能建议

### 推荐的模型尺寸

| 尺寸 | 体素数 | 性能 | 适用场景 |
|-----|-------|------|---------|
| 5x5x5 | ~125 | ⚡⚡⚡ 优秀 | 小物品、装饰 |
| 10x10x10 | ~1000 | ⚡⚡ 良好 | 生物、家具 |
| 20x20x20 | ~8000 | ⚡ 可接受 | 建筑、大型物体 |
| >30x30x30 | >27000 | ⚠️ 可能卡顿 | 不推荐 |

### 优化技巧

1. **稀疏模型更高效**：不要填满整个空间，只放必要的体素
2. **批量生成时分帧**：如果要生成很多模型，使用协程分帧处理
3. **重用相同模型**：考虑使用GameObject.Instantiate复制已生成的模型

## 🐛 常见问题

### 问题1：按G键没有反应

**解决方案**：
- 检查Console是否有错误信息
- 确认 `VoxelModelTest` 脚本已正确挂载
- 确认游戏正在运行（按了Play按钮）

### 问题2：模型生成了但看不见

**解决方案**：
- 模型可能在你身后，尝试转身或移动
- 调整 `spawnDistance` 参数
- 检查模型是否在地下（调整Y坐标）

### 问题3：模型没有纹理/全白

**解决方案**：
- 确保场景中有 `TerrainChunk` 对象（脚本会从它获取材质）
- 检查地形材质是否正确设置
- 在 `Ground.mat` 中检查纹理图集

### 问题4：JSON解析失败

**解决方案**：
- 检查JSON格式是否正确（使用在线JSON验证器）
- 确认所有字段名称正确（区分大小写）
- 确认方块类型名称正确（Grass、Dirt、Stone、Trunk、Leaves）

## 📚 完整示例

这是一个完整的工作流程示例：

### 1. 向LLM请求

```
请生成一个简单的椅子模型JSON，使用Dirt作为椅子主体，
Stone作为椅腿，大小约5x5x5。
```

### 2. LLM返回

```json
{
  "name": "SimpleChair",
  "size": {"x": 4, "y": 4, "z": 4},
  "voxels": [
    {"x": 0, "y": 0, "z": 0, "blockType": "Stone"},
    {"x": 3, "y": 0, "z": 0, "blockType": "Stone"},
    {"x": 0, "y": 0, "z": 3, "blockType": "Stone"},
    {"x": 3, "y": 0, "z": 3, "blockType": "Stone"},
    {"x": 0, "y": 2, "z": 0, "blockType": "Dirt"},
    {"x": 1, "y": 2, "z": 0, "blockType": "Dirt"},
    {"x": 2, "y": 2, "z": 0, "blockType": "Dirt"},
    {"x": 3, "y": 2, "z": 0, "blockType": "Dirt"},
    {"x": 0, "y": 2, "z": 1, "blockType": "Dirt"},
    {"x": 1, "y": 2, "z": 1, "blockType": "Dirt"},
    {"x": 2, "y": 2, "z": 1, "blockType": "Dirt"},
    {"x": 3, "y": 2, "z": 1, "blockType": "Dirt"},
    {"x": 1, "y": 3, "z": 0, "blockType": "Dirt"},
    {"x": 2, "y": 3, "z": 0, "blockType": "Dirt"}
  ]
}
```

### 3. 在Unity中使用

选择两种方式之一：

**方式A：快速测试（推荐）**
```csharp
// 在VoxelModelTest.cs的Update中添加
if (Input.GetKeyDown(KeyCode.K))
{
    string chairJson = @"{复制上面的JSON}";
    GenerateModel(chairJson, "SimpleChair");
}
```

**方式B：使用组件**
1. 创建GameObject
2. 添加VoxelModelGenerator组件
3. 粘贴JSON到Inspector
4. 按Play

### 4. 查看结果

按对应的按键，椅子模型就会出现在你面前！

## 🎓 下一步

现在你已经掌握了基础，可以尝试：

1. **创建自己的模型**：手动编写JSON或让LLM帮你生成
2. **整合到游戏中**：将生成系统集成到你的游戏逻辑
3. **扩展功能**：添加动画、交互、物理效果
4. **优化性能**：对于大量模型，实现对象池和LOD系统

## 📖 更多文档

- 详细文档：`体素模型生成器使用说明.md`
- 示例JSON：`example_voxel_models.json`
- 项目架构：`项目架构总结.md`

---

祝你玩得开心！🎮

如果遇到问题，检查Unity Console的错误信息，或者查看详细文档。
